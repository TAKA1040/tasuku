# 影響範囲チェックレポート

**作成日**: 2025-10-01
**削除作業**: Phase 2-6 完了後
**ビルド状況**: ✅ 成功

---

## 📊 削除実施サマリー

### 削除済みファイル: 合計27ファイル（約83KB）

| Phase | カテゴリ | ファイル数 | サイズ | ステータス |
|-------|---------|-----------|--------|-----------|
| Phase 2 | 移行完了ページ | 2 | 13KB | ✅ 移動完了 |
| Phase 3 | 開発スクリプト | 6 | 14KB | ✅ 移動完了（.dev-toolsなし） |
| Phase 4 | 実行済みSQL | 8 | 6.6KB | ✅ 移動完了 |
| Phase 5 | 未使用ライブラリ | 2 | 8KB | ⚠️ 復元必要 |
| Phase 6 | 重複ドキュメント | 4 | 29KB | ✅ 移動完了 |

---

## ⚠️ 発見された依存関係（復元したファイル）

### 1. `src/lib/utils/recurring-test.ts`
**ステータス**: ⚠️ 削除不可 → **復元済み**

**依存元**:
- `src/hooks/useDatabase.ts`

**エラー内容**:
```
Module not found: Can't resolve '@/lib/utils/recurring-test'
```

**理由**: `useDatabase.ts`からインポートされている
**対処**: DELLフォルダから`src/lib/utils/`へ復元

---

### 2. `src/lib/db/migrate-to-unified.ts`
**ステータス**: ⚠️ 削除不可 → **復元済み**

**依存元**:
- `DELL/pages/migrate-unified/page.tsx` ← **DELLに移動したページ自身が参照**

**エラー内容**:
```
Cannot find module '@/lib/db/migrate-to-unified'
```

**理由**: 移行ページ自体が参照しているため、ページごと削除しないとエラー
**対処**: DELLフォルダから`src/lib/db/`へ復元

---

## 🔍 チェックすべき機能と影響範囲

### ✅ チェック不要（問題なし）

#### 1. デバッグ・テストページ
- `/debug` - 残存（開発環境限定で動作）
- `/test` - 残存（開発環境限定で動作）
- `/restore` - 残存（タスク復旧機能）

**理由**: これらは削除していないため影響なし

---

### ⚠️ 要チェック（移動した機能）

#### 2. `/migrate-unified` ページ
**場所**: `DELL/pages/migrate-unified/`
**状況**: ページごと移動済み

**チェック項目**:
- [ ] 本番環境でアクセスできないことを確認
- [ ] ブラウザで`https://tasuku.apaf.me/migrate-unified`にアクセス
- [ ] 404エラーが表示されることを確認

**期待される動作**: 404 Not Found

**注意**: `migrate-to-unified.ts`を復元したため、もしページを復元すれば再度動作可能

---

#### 3. `/shopping-test` ページ
**場所**: `DELL/pages/shopping-test/`
**状況**: ページごと移動済み

**チェック項目**:
- [ ] 本番環境でアクセスできないことを確認
- [ ] ブラウザで`https://tasuku.apaf.me/shopping-test`にアクセス
- [ ] 404エラーが表示されることを確認

**期待される動作**: 404 Not Found

---

### ✅ 主要機能の動作確認

#### 4. タスク管理機能（/today）
**影響度**: なし
**理由**: 依存ファイルなし

**チェック項目**:
- [ ] タスクの作成
- [ ] タスクの完了
- [ ] タスクの編集
- [ ] タスクの削除

---

#### 5. 繰り返しタスク機能（/templates）
**影響度**: ⚠️ 低（`recurring-test.ts`を復元済み）
**理由**: `recurring-test.ts`を削除→復元した経緯あり

**チェック項目**:
- [ ] テンプレートの作成
- [ ] テンプレートからのタスク生成
- [ ] 繰り返しパターンの設定（毎日/毎週/毎月）
- [ ] テンプレートの編集・削除

**特に確認**: `useDatabase.ts`経由の繰り返しタスク生成処理

---

#### 6. 買い物リスト機能
**影響度**: なし
**理由**: 依存ファイルなし（/shopping-testは削除したがテスト用）

**チェック項目**:
- [ ] 買い物タスクの作成
- [ ] 買い物リストの表示
- [ ] サブタスクの管理

---

#### 7. 検索機能（/search）
**影響度**: なし
**理由**: 依存ファイルなし

**チェック項目**:
- [ ] タスク検索
- [ ] フィルタ機能
- [ ] 検索結果の表示

---

#### 8. 完了タスク表示（/done）
**影響度**: なし
**理由**: 依存ファイルなし

**チェック項目**:
- [ ] 完了タスクの表示
- [ ] 期間フィルタ（今日/今週/今月/全て）
- [ ] 繰り返しタスクの達成度カレンダー
- [ ] タスクの復元（未完了に戻す）

---

## 🚨 削除によって無効化された機能

### 1. データベース移行機能（/migrate-unified）
**ステータス**: ❌ 無効化（意図的）
**理由**: すでに移行完了済みのため不要
**影響**: なし（使用予定なし）

### 2. 買い物機能テストページ（/shopping-test）
**ステータス**: ❌ 無効化（意図的）
**理由**: 開発・テスト用ページ
**影響**: なし（本番機能ではない）

---

## 📋 推奨チェック手順

### ステップ1: 本番環境での確認
```bash
# 1. 削除したページが404になることを確認
curl https://tasuku.apaf.me/migrate-unified  # → 404期待
curl https://tasuku.apaf.me/shopping-test     # → 404期待

# 2. 主要ページが正常に表示されることを確認
curl https://tasuku.apaf.me/today             # → 200 OK
curl https://tasuku.apaf.me/templates         # → 200 OK
curl https://tasuku.apaf.me/search            # → 200 OK
curl https://tasuku.apaf.me/done              # → 200 OK
```

### ステップ2: ブラウザでの動作確認
1. **ログイン**: https://tasuku.apaf.me/login
2. **今日のタスク**: タスク作成・完了・編集
3. **テンプレート**: 繰り返しタスク作成・タスク生成
4. **買い物リスト**: 買い物タスク作成
5. **検索**: タスク検索機能
6. **完了タスク**: 達成度カレンダー表示

### ステップ3: エラーログ確認
- ブラウザのコンソールでJavaScriptエラーがないか確認
- Vercelのログでサーバーエラーがないか確認

---

## 🔄 問題発生時の復元方法

### 個別ファイル復元
```bash
# recurring-test.tsの復元（すでに実施済み）
mv DELL/lib/recurring-test.ts src/lib/utils/

# migrate-to-unified.tsの復元（すでに実施済み）
mv DELL/lib/migrate-to-unified.ts src/lib/db/

# ページの復元（必要な場合）
mv DELL/pages/migrate-unified src/app/
mv DELL/pages/shopping-test src/app/
```

### Git復元
```bash
# Phase 2-6の変更をすべて取り消し
git reset --hard fe85d83  # Phase 1直後の状態に戻す

# または特定ファイルのみ復元
git checkout HEAD -- src/lib/utils/recurring-test.ts
```

---

## 📊 最終ステータス

### 削除成功: 25ファイル（約75KB）
| カテゴリ | ファイル数 | サイズ |
|---------|-----------|--------|
| 移行完了ページ | 2 | 13KB |
| 開発スクリプト | 6 | 14KB |
| 実行済みSQL | 8 | 6.6KB |
| 重複ドキュメント | 4 | 29KB |
| **合計** | **25** | **約75KB** |

### 復元したファイル: 2ファイル（約8KB）
- `src/lib/utils/recurring-test.ts` - useDatabase.tsから参照
- `src/lib/db/migrate-to-unified.ts` - migrate-unifiedページから参照

### ビルド結果
- ✅ 成功（警告のみ、既存と同じ）
- ✅ エラーなし
- ✅ 主要機能に影響なし

---

## ⚠️ 重要な注意事項

1. **recurring-test.ts は削除不可**
   - `useDatabase.ts`から使用されているため
   - 繰り返しタスク機能に必要

2. **migrate-to-unified.ts は削除不可**
   - `/migrate-unified`ページから参照
   - ページごと削除すれば削除可能だが、現時点では保持推奨

3. **prompt.txt は絶対に削除しない**
   - ユーザーからの指示ファイル
   - 削除候補に含めない

4. **Supabase migrations は絶対に削除しない**
   - データベース履歴として必須
   - 削除するとDB再構築時に問題発生

---

## 🎯 次回作業の推奨事項

### さらに削除可能なファイル
なし（現時点では安全に削除できるファイルはすべて削除済み）

### 追加で確認すべき項目
1. **1-2週間の観察期間**を設けて問題ないことを確認
2. 問題なければ**DELLフォルダごと削除**を検討
3. `.dev-tools`フォルダが存在する場合は別途削除検討

---

**このレポートは削除作業完了後の影響範囲を記録したものです。チェック項目を確認して問題がなければ、Git commitしてデプロイしてください。**
