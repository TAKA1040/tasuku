## ğŸ” ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ç”»é¢ã®æ¬ è½ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ä¾é ¼

### å•é¡Œã®ç™ºè¦‹
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ç”»é¢ï¼ˆ/templates ãƒšãƒ¼ã‚¸ï¼‰ã§ä»¥ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ï¼š
- é–‹å§‹æ™‚åˆ» (start_time)
- çµ‚äº†æ™‚åˆ» (end_time)
- ãã®ä»–ã®æ‹¡å¼µãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¯èƒ½æ€§

### ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç¢ºèª
ãƒ¦ãƒ¼ã‚¶ãƒ¼æä¾›ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ç¢ºèªã•ã‚ŒãŸå†…å®¹ï¼š
- ã‚¿ã‚¤ãƒˆãƒ«: âœ… è¡¨ç¤ºã‚ã‚Š
- ãƒ¡ãƒ¢: âœ… è¡¨ç¤ºã‚ã‚Š
- ã‚«ãƒ†ã‚´ãƒª: âœ… è¡¨ç¤ºã‚ã‚Šï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³: å¥åº·ï¼‰
- é‡è¦åº¦: âœ… è¡¨ç¤ºã‚ã‚Šï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³: æ™®é€šï¼‰
- é–¢é€£URL: âœ… è¡¨ç¤ºã‚ã‚Šï¼ˆå…¥åŠ›æ¬„ + è¿½åŠ ãƒœã‚¿ãƒ³ï¼‰
- ç¹°ã‚Šè¿”ã—ãƒ‘ã‚¿ãƒ¼ãƒ³: âœ… è¡¨ç¤ºã‚ã‚Šï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³: æ¯æ—¥ï¼‰
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: âœ… è¡¨ç¤ºã‚ã‚Šï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
- **é–‹å§‹æ™‚åˆ»: âŒ è¡¨ç¤ºãªã—**
- **çµ‚äº†æ™‚åˆ»: âŒ è¡¨ç¤ºãªã—**

### èª¿æŸ»æ¸ˆã¿äº‹é …

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒç¢ºèª
```javascript
// check-template-schema.js, compare-schemas.js, check-recurring-tasks.js ã§èª¿æŸ»
```

**çµæœ:**
- `unified_tasks` ãƒ†ãƒ¼ãƒ–ãƒ«: `start_time`, `end_time` ã‚«ãƒ©ãƒ ãŒå­˜åœ¨ âœ…
- `recurring_templates` ãƒ†ãƒ¼ãƒ–ãƒ«: ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ âŒ
- ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯ãŒ10ä»¶ä»¥ä¸Šå­˜åœ¨ã™ã‚‹ãŒã€å…¨ã¦ `start_time` ãŒ null
- å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆIDï¼ˆ3ä»¶ï¼‰ãŒå…¨ã¦å­˜åœ¨ã—ãªã„

#### 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
- `20250926000001_add_time_fields.sql`: unified_tasks ã« start_time/end_time è¿½åŠ  âœ…
- `20250930000001_add_extended_fields_to_recurring_templates.sql`: recurring_templates ã« start_time/end_time (TEXTå‹) è¿½åŠ  âœ…

#### 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¢ºèª
- `src/app/templates/page.tsx`: ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã«æ™‚åˆ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ**å®Ÿè£…ã•ã‚Œã¦ã„ãªã„** âŒ
- interface RecurringTemplate (6-22è¡Œç›®): start_time/end_time ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ**å®šç¾©ã•ã‚Œã¦ã„ãªã„** âŒ
- updateTemplate é–¢æ•° (270-348è¡Œç›®): start_time/end_time ã‚’**æ›´æ–°ã—ã¦ã„ãªã„** âŒ

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

**é‡å¤§å•é¡Œ1: recurring_templates ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç©º**
```bash
ğŸ“Š recurring_templates ç·ä»¶æ•°: 0ä»¶
```

**é‡å¤§å•é¡Œ2: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‚ç…§ã®ä¸æ•´åˆ**
```
å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆID:
âŒ 42c8f9c9-5ae7-4b46-ad26-ed7c8a767dfc â†’ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“ï¼
âŒ 34dd0ec4-1e29-4c44-951e-b1c5d8c78daa â†’ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“ï¼
âŒ 0dbaca9e-5240-4e00-8729-16e883e65da7 â†’ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“ï¼
```

**é‡å¤§å•é¡Œ3: UIã«æ™‚åˆ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„**
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã«é–‹å§‹æ™‚åˆ»ãƒ»çµ‚äº†æ™‚åˆ»ã®å…¥åŠ›æ¬„ãŒãªã„
- TypeScript interface ã«å®šç¾©ãŒãªã„
- ä¿å­˜å‡¦ç†ã«å«ã¾ã‚Œã¦ã„ãªã„

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®é‡è¦ãªæŒ‡æ‘˜
> ã€ŒDBã‚’èª¿ã¹ãŸæ™‚ã¯ã‚ã£ãŸã‚ˆã€

â†’ **ä»¥å‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯recurring_templatesã«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¦ã„ãŸå¯èƒ½æ€§**
â†’ RLSã®å•é¡Œã€ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å•é¡Œã®å¯èƒ½æ€§

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ç‰ˆã§å®Ÿæ–½ï¼‰

#### å„ªå…ˆåº¦1: ãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ç¢ºèª
1. **Supabaseç®¡ç†ç”»é¢ã§ç›´æ¥ç¢ºèª**
   - https://supabase.com/dashboard/project/wgtrffjwdtytqgqybjwx/editor
   - `recurring_templates` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é–‹ã
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãªã—ã§å…¨è¡Œè¡¨ç¤º
   - ãƒ‡ãƒ¼ã‚¿ãŒå®Ÿéš›ã«å­˜åœ¨ã™ã‚‹ã‹ã€ã‚«ãƒ©ãƒ æ§‹æˆã‚’ç¢ºèª

2. **ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«ã‚­ãƒ¼ã§ã®ç¢ºèª**
   - RLSã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦å…¨ãƒ‡ãƒ¼ã‚¿å–å¾—
   - ANON_KEYã§ã¯ãªãSERVICE_ROLE_KEYã§å†ç¢ºèª

3. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ç¢ºèª**
   ```javascript
   // F12é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« â†’ Console
   const { data } = await supabase.from('recurring_templates').select('*');
   console.log('Templates:', data);
   console.log('Columns:', data[0] ? Object.keys(data[0]) : 'No data');
   ```

#### å„ªå…ˆåº¦2: UIã®ä¿®æ­£ï¼ˆãƒ‡ãƒ¼ã‚¿ç¢ºèªå¾Œï¼‰

**A) templates/page.tsx ã®ä¿®æ­£**

1. **interface ã«è¿½åŠ :**
```typescript
interface RecurringTemplate {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...
  start_time?: string    // è¿½åŠ 
  end_time?: string      // è¿½åŠ 
}
```

2. **ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã«è¿½åŠ ï¼ˆè¡Œ872ä»˜è¿‘ï¼‰:**
```typescript
{/* é–‹å§‹æ™‚åˆ» */}
<div style={{ marginBottom: '15px' }}>
  <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500' }}>
    é–‹å§‹æ™‚åˆ»
  </label>
  <input
    type="time"
    value={editingTemplate.start_time || ''}
    onChange={(e) => setEditingTemplate({
      ...editingTemplate,
      start_time: e.target.value || undefined
    })}
    style={{
      width: '100%',
      padding: '8px',
      border: '1px solid #d1d5db',
      borderRadius: '4px',
      fontSize: '14px'
    }}
  />
</div>

{/* çµ‚äº†æ™‚åˆ» */}
<div style={{ marginBottom: '15px' }}>
  <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500' }}>
    çµ‚äº†æ™‚åˆ»
  </label>
  <input
    type="time"
    value={editingTemplate.end_time || ''}
    onChange={(e) => setEditingTemplate({
      ...editingTemplate,
      end_time: e.target.value || undefined
    })}
    style={{
      width: '100%',
      padding: '8px',
      border: '1px solid #d1d5db',
      borderRadius: '4px',
      fontSize: '14px'
    }}
  />
</div>
```

3. **updateTemplate é–¢æ•°ã«è¿½åŠ ï¼ˆè¡Œ286-301ï¼‰:**
```typescript
const { error } = await supabase
  .from('recurring_templates')
  .update({
    title: template.title,
    memo: template.memo,
    category: template.category,
    importance: template.importance,
    start_time: template.start_time,  // è¿½åŠ 
    end_time: template.end_time,      // è¿½åŠ 
    pattern: template.pattern,
    weekdays: template.weekdays,
    day_of_month: template.day_of_month,
    month_of_year: template.month_of_year,
    day_of_year: template.day_of_year,
    active: template.active,
    urls: normalizedUrls,
    updated_at: new Date().toISOString()
  })
  .eq('id', template.id)
```

4. **é–¢é€£ã‚¿ã‚¹ã‚¯ã®æ™‚åˆ»ã‚‚æ›´æ–°ï¼ˆè¡Œ324-328ï¼‰:**
```typescript
const { error: updateTasksError } = await supabase
  .from('unified_tasks')
  .update({
    urls: normalizedUrls,
    start_time: template.start_time,  // è¿½åŠ 
    end_time: template.end_time       // è¿½åŠ 
  })
  .eq('recurring_template_id', template.id)
  .eq('completed', false)
```

**B) æ–°è¦ã‚¿ã‚¹ã‚¯ä½œæˆãƒ•ã‚©ãƒ¼ãƒ ã‚‚ç¢ºèª**
- `src/components/TaskCreateForm2.tsx` ã«æ™‚åˆ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚‹ã‹ç¢ºèª
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆæ™‚ï¼ˆtoday/page.tsx ã® handleCreateRecurringï¼‰ã«æ™‚åˆ»ã‚’ä¿å­˜ã—ã¦ã„ã‚‹ã‹ç¢ºèª

#### å„ªå…ˆåº¦3: ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ä¿®å¾©

ã‚‚ã—recurring_templatesãŒæœ¬å½“ã«ç©ºãªã‚‰ï¼š
1. unified_tasksã®ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯ã‹ã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é€†ç”Ÿæˆ
2. start_timeãªã©ã®æ¬ è½ãƒ‡ãƒ¼ã‚¿ã¯æ‰‹å‹•è¨­å®šã‚’ä¿ƒã™

### ç¢ºèªã™ã¹ããƒã‚¤ãƒ³ãƒˆ
- [ ] Supabaseç®¡ç†ç”»é¢ã§recurring_templatesã®å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
- [ ] ã‚«ãƒ©ãƒ åãŒæ­£ç¢ºã« `start_time` ã‹ç¢ºèªï¼ˆ`startTime` ç­‰ã®ã‚±ãƒ¼ã‚¹ãƒŸã‚¹ãŒãªã„ã‹ï¼‰
- [ ] RLSãƒãƒªã‚·ãƒ¼ã§ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚Œã‚‹ã‹ç¢ºèª
- [ ] ãƒ‡ãƒ¼ã‚¿å‹ãŒ TEXT ã‹ TIME ã‹ç¢ºèªï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ TEXTï¼‰
- [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆå‡¦ç†ï¼ˆhandleCreateRecurringï¼‰ã§æ™‚åˆ»ã‚’ä¿å­˜ã—ã¦ã„ã‚‹ã‹ç¢ºèª

### ä½œæˆã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆå‚è€ƒç”¨ï¼‰
- `check-template-schema.js`: ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ¼ãƒç¢ºèª
- `compare-schemas.js`: recurring_templates ã¨ unified_tasks ã®æ¯”è¼ƒ
- `check-recurring-tasks.js`: ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‚ç…§ã®ç¢ºèª
- `check-current-user.js`: ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDç¢ºèªï¼ˆèªè¨¼ã‚¨ãƒ©ãƒ¼ã§ä½¿ç”¨ä¸å¯ï¼‰

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `src/app/templates/page.tsx` (1111è¡Œ)
- `src/app/today/page.tsx` (handleCreateRecurring: 305-382è¡Œ)
- `supabase/migrations/20250930000001_add_extended_fields_to_recurring_templates.sql`

---

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: Supabaseç®¡ç†ç”»é¢ã§recurring_templatesã®å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ä½œæ¥­ã‚’ç¶šè¡Œ**
