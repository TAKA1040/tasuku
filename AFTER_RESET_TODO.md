# リセット後の作業内容 - 統一データベース+フィルター方式実装

## 📋 現在の状況
- **日時**: 2025年9月22日
- **リセット先**: コミット 72ff8ca (feat: complete unified numbering system with display number management)
- **解決すべき問題**: 買い物リストが「やることリスト」で表示されない（DBと連動していない）

## 🎯 実装すべき統一データベース+フィルター方式

### prompt.txtで説明されていた設計：
```
新しいデータベースのテーブルを作ったときに、すべてのタスクを一つのデータベースのテーブルで管理して、
表示画面ではすべてフィルターを使って表示の分類を分けていくという方式に変えていったはず。
```

### 具体的な変更内容：

#### 1. 統一データベースを使用
- **問題**: 現在のコードは複数のデータソース（tasks, recurring_tasks, ideas）を個別に取得
- **解決**: unified_tasks テーブルを主データソースとして使用し、フィルターで表示を分ける

#### 2. IdeaBoxの買い物リスト表示修正
- **問題**: 買い物カテゴリのタスクが「やることリスト」セクションで表示されない
- **解決**: 買い物カテゴリのタスクはサブタスクと一緒に「リスト」として表示する

#### 3. ShoppingTasksSectionとの統合
- **問題**: 買い物タスクが重複して表示される可能性
- **解決**: unified_tasks から買い物カテゴリをフィルターして統一的に表示

## 🔧 具体的な修正手順

### Step 1: useUnifiedTasks フックの活用
- 現在のコード: `src/hooks/useUnifiedTasks.ts` が既に存在
- 修正: `src/app/today/page.tsx` でこのフックを活用

### Step 2: IdeaBox の買い物リスト統合
- ファイル: `src/components/IdeaBox.tsx`
- 修正: 統一データベースから買い物カテゴリタスクを取得して表示

### Step 3: フィルターベースの表示分離
- 今日のタスク: `task_type = 'NORMAL'` かつ `due_date = 今日`
- 買い物リスト: `category = '買い物'` のタスクとそのサブタスク
- やることリスト: `task_type = 'IDEA'` のアイテム

### Step 4: 表示名の統一
- 買い物カテゴリでは "タスク" ではなく "リスト" と表示
- アイテム数表示の修正

## 📁 主要な修正ファイル

1. **`src/app/today/page.tsx`** (Line 31-34)
   - useUnifiedTasks フックを導入
   - 個別のデータ取得フックを統合

2. **`src/components/IdeaBox.tsx`** (Line 153-)
   - 統一データベースからの買い物リスト取得

3. **`src/components/ShoppingTasksSection.tsx`**
   - 統一データベースとの整合性確認

## ⚠️ 注意点

1. **データ移行**: unified_tasks テーブルに既存データが正しく移行されているか確認
2. **パフォーマンス**: 単一クエリでフィルター分けできるよう最適化
3. **リアルタイム同期**: 新規作成・更新時の統一データベース反映

## 🎯 成功判定基準

1. **買い物リスト表示**: 「やることリスト」セクションで買い物カテゴリのタスクが「○件のリスト」として表示される
2. **サブタスク連動**: 買い物タスクのサブタスクが正しく表示される
3. **重複なし**: ShoppingTasksSectionとの重複表示がない
4. **リアルタイム**: 新規作成・完了・削除がすぐに反映される

## 📝 テスト手順

1. 買い物カテゴリのタスクを作成
2. そのタスクにサブタスクを追加
3. 「やることリスト」セクションで表示確認
4. 完了・未完了の切り替えテスト
5. 削除・編集のテスト

---

**重要**: この方式により、複雑化していたデータ取得ロジックがシンプルになり、
統一データベースからのフィルター表示で一貫性のある動作が実現される。